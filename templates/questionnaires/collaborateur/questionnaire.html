{% extends 'base.html' %}
{% load static %}

{% block title %}Questionnaire Collaborateur - {{ nom_entreprise }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'questionnaires/css/questionnaire.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'questionnaires/js/autosave.js' %}?v=4"></script>
<script src="{% static 'questionnaires/js/progress-bar.js' %}"></script>
{% endblock %}

{% block content %}
<div class="questionnaire-container">
    <div class="questionnaire-header card">
        <h1>Questionnaire Collaborateur</h1>
        <p class="company-info">
            <strong>Entreprise :</strong> {{ nom_entreprise }}<br>
            <strong>SIREN :</strong> {{ siren }}
        </p>
    </div>

    <form method="post" id="questionnaire-form" class="questionnaire-form">
        {% csrf_token %}

        <!-- ASSUJETTISSEMENT ET ACTIVITÉ -->
        <div class="card section">
            <h2>1. Assujettissement et activité</h2>

            <div class="form-group">
                <label class="strong">L'entreprise est-elle assujettie à la TVA ? <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="assujettie_tva" value="yes" required>
                        Oui
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="assujettie_tva" value="no">
                        Non
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="assujettie_tva" value="unsure">
                        J'ai un doute
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="code_ape" class="strong">Code APE (NAF)</label>
                <input type="text" name="code_ape" id="code_ape" placeholder="Ex: 62.01Z">
                <small class="form-help">Code activité principale de l'entreprise</small>
            </div>

            <div class="form-group">
                <label for="activite_precise" class="strong">Description précise de l'activité <span class="required">*</span></label>
                <textarea name="activite_precise" id="activite_precise" rows="3"
                    placeholder="Décrivez précisément l'activité de l'entreprise..." required></textarea>
            </div>

            <div class="form-group">
                <label class="strong">Taille de l'entreprise <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="taille_entreprise" value="small_medium" required>
                        TPE/PME
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="taille_entreprise" value="mid_sized">
                        ETI (Entreprise de Taille Intermédiaire)
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="taille_entreprise" value="large">
                        Grande entreprise
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="strong">Régime de TVA</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="regime_tva" value="franchise">
                        Franchise en base
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="regime_tva" value="simplified_real">
                        Réel simplifié
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="regime_tva" value="quarterly_real">
                        Réel trimestriel
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="regime_tva" value="monthly_real">
                        Réel mensuel
                    </label>
                </div>
            </div>

            <div class="form-group">
                {% comment %} <label>Secteur d'activité (exonération TVA)</label> {% endcomment %}
                <label class="strong">L'entreprise exerce-t-elle la totalité de son chiffre d'affaires dans l'une des activités suivantes, exonérées de TVA :</label>
                <p>L'objectif ici est de détecter les cas dans lesquels il n'y aura qu'une plateforme en réception et pas de plateforme d'émission (assujetti TVA exonéré sur la totalité de son chiffre d'affaires)</p>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="activite_exoneree_tva" value="health">
                        Prestations dans le domaine de la santé
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activite_exoneree_tva" value="education">
                        Prestations d'enseignement et de formation
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activite_exoneree_tva" value="real_estate">
                        Opérations immobilières
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activite_exoneree_tva" value="nonprofit">
                        Opérations réalisées par les associations à but non lucratif
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activite_exoneree_tva" value="banking">
                        Opérations bancaires et financières
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activite_exoneree_tva" value="insurance">
                        Opérations d'assurance et de réassurance
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="activite_exoneree_tva" value="mixed">
                        Elle n'exerce pas dans ces secteurs ou elle a une ativité mixte (exonérée + soumise à TVA)
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="strong">L'entreprise est-elle déjà inscrite sur une plateforme agréée ?</label>
                <p>Ce point peut être vérifié directement sur l'annuaire public <a href="https://chorus-pro.gouv.fr" target="_blank" rel="noopener">ici</a></p>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="plateforme_agreee" value="True">
                        Oui
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="plateforme_agreee" value="False">
                        Non
                    </label>
                </div>
                <input type="text" name="plateforme_agreee_nom" placeholder="Si oui, laquelle ?" class="conditional-input">
            </div>
        </div>

        <!-- FLUX FACTURATION - VENTES -->
        <div class="card section">
            <h2>2. Flux de facturation - Ventes</h2>

            <div class="form-group">
                <label class="strong">Nombre approximatif de factures de ventes par an :</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_ventes" value="less_than_50">
                        Moins de 50
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_ventes" value="between_50_200">
                        Entre 50 et 200
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_ventes" value="between_200_1000">
                        Entre 200 et 1000
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_ventes" value="between_1000_5000">
                        Entre 1000 et 5000
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_ventes" value="more_than_5000">
                        Plus de 5000
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_ventes" value="not_applicable">
                        N/A
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="strong">Nombre approximatif de clients actifs</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="nb_clients_actifs" value="less_than_10">
                        Moins de 10
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_clients_actifs" value="between_10_50">
                        Entre 10 et 50
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_clients_actifs" value="between_50_200">
                        Entre 50 et 200
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_clients_actifs" value="more_than_200">
                        Plus de 200
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_clients_actifs" value="not_applicable">
                        N/A
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="strong">Types de ventes réalisées par l'entreprise(cochez si applicable)</label>
                <div class="checkbox-group">
                    <label class="checkbox-option">
                        <input type="checkbox" name="vente_btob_domestique" value="1">
                        Ventes à des entreprises françaises (BtoB domestique)
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="vente_btob_export" value="1">
                        Ventes à des entreprises étrangères (BtoB export)
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="vente_btoc_facture" value="1">
                        Ventes à des particuliers avec facture (BtoC)
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="vente_btoc_caisse" value="1">
                        Ventes à des particuliers avec caisse (BtoC)
                    </label>
                </div>
            </div>
        </div>

        <!-- FLUX FACTURATION - ACHATS -->
        <div class="card section">
            <h2>3. Flux de facturation - Achats</h2>

            <div class="form-group">
                <label class="strong">Nombre approximatif de factures d'achats reçues par an :</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_achats" value="less_than_50">
                        Moins de 50
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_achats" value="between_50_200">
                        Entre 50 et 200
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_achats" value="between_200_1000">
                        Entre 200 et 1000
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_achats" value="between_1000_5000">
                        Entre 1000 et 5000
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_achats" value="more_than_5000">
                        Plus de 5000
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_factures_achats" value="not_applicable">
                        N/A
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="strong">Nombre approximatif de fournisseurs actifs :</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="nb_fournisseurs_actifs" value="less_than_10">
                        Moins de 10
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_fournisseurs_actifs" value="between_10_50">
                        Entre 10 et 50
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_fournisseurs_actifs" value="between_50_200">
                        Entre 50 et 200
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_fournisseurs_actifs" value="more_than_200">
                        Plus de 200
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="nb_fournisseurs_actifs" value="not_applicable">
                        N/A
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="strong">Types d'achats réalisés par l'entreprise(cochez si applicable)</label>
                <div class="checkbox-group">
                    <label class="checkbox-option">
                        <input type="checkbox" name="achat_btob_domestique" value="1">
                        Achats auprès d'entreprises françaises (BtoB domestique)
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="achat_btob_intracommunautaire" value="1">
                        Achats auprès d'entreprises étrangères (BtoB intracommunautaires)
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="achat_btob_hors_ue" value="1">
                        Achats de prestations de services auprès d'entreprises étrangères (BtoB hors UE)
                    </label>
                </div>
            </div>
        </div>

        <!-- INFORMATIONS COMPLÉMENTAIRES -->
        <div class="card section">
            <h2>4. Informations complémentaires</h2>

            <div class="form-group">
                <label for="commentaires" class="strong">Observations et informations complémentaires</label>
                <textarea name="commentaires" id="commentaires" rows="4"
                    placeholder="Observations, particularités, points d'attention..."></textarea>
            </div>
        </div>

        <!-- Actions -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                Valider et enregistrer
            </button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                Annuler
            </a>
        </div>
    </form>
</div>
{% endblock %}
